---
import { getCollection } from 'astro:content'
import Column from 'fulldev-ui/components/Column.astro'
import Heading from 'fulldev-ui/components/Heading.astro'
import Link from 'fulldev-ui/components/Link.astro'

const { toc } = Astro.props
const slug = Astro.url.pathname.replace(/^\/|\/$/g, '')
const url = Astro.url.href
---

<Column
  class:list="toc"
  as="aside"
>
  {
    toc?.length > 0 &&
      toc.map((item: any) => (
        <>
          <Heading
            level={6}
            set:html={item.heading}
          />
          {item.links?.map((link: any) => (
            <Link
              {...link}
              class="toc-link"
              color={url.endsWith(link.href) ? 'brand' : undefined}
            />
          ))}
          {item.folder &&
            (async () => {
              const pages = await getCollection(
                'pages',
                (entry: any) =>
                  entry.slug.startsWith(item.folder) &&
                  !entry.slug.endsWith(item.folder)
              )
              return pages.map((page: any) => (
                <Link
                  href={`/${page.slug}`}
                  class="toc-link"
                  color={slug === page.slug ? 'brand' : undefined}
                  set:html={page.data.title}
                />
              ))
            })()}
        </>
      ))
  }
</Column>

<style lang="scss" is:global>
  .toc {
    display: none;
    box-sizing: border-box;
    border-left: 1px solid var(--color-a6);
    padding: var(--space-6) 0 var(--space-6) min(var(--space-5), var(--gutter));
    height: 100vh;
    max-height: 100vh;
    overflow-y: auto;

    .toc-link {
      font-size: var(--text-2);
    }

    @media (min-width: 1024px) {
      display: flex;
    }
  }
</style>
