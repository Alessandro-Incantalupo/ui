---
import type { ComponentProps } from 'astro/types'
import {
  getEntry,
  type CollectionEntry,
  type ContentCollectionKey,
} from 'astro:content'
import { SectionRoot, SectionSegment } from '.'
import Form from '../Form.astro'
import ButtonGroup from '../button/ButtonGroup.astro'
import ChannelGroup from '../channel/ChannelGroup.astro'
import Image from '../image/Image.astro'
import { Writeup } from '../writeup'

interface Props
  extends ComponentProps<typeof SectionRoot>,
    ComponentProps<typeof SectionSegment>,
    ComponentProps<typeof Writeup>,
    ComponentProps<typeof ButtonGroup> {
  image: ComponentProps<typeof Image>
  reference?: {
    collection: ContentCollectionKey
    slug: CollectionEntry<ContentCollectionKey>['slug']
  }
  collection?: ContentCollectionKey
  slug?: CollectionEntry<ContentCollectionKey>['slug']
}

let { collection, slug, reference, ...restProps } = Astro.props
const entry =
  reference &&
  (await getEntry({
    collection: collection || reference.collection,
    slug: slug || reference.slug,
  }))
const props = { ...entry?.data, ...restProps }
---

<SectionRoot {...props}>
  <SectionSegment {...props}>
    <Writeup {...props}>
      <slot name="writeup" />
    </Writeup>
    <ButtonGroup {...props} />
    <!-- <ChannelGroup {...props} /> -->
    <slot name="segment" />
  </SectionSegment>
  <Image {...props.image} />
  <!-- <Form {...props} /> -->
  <slot />
</SectionRoot>
