---
import { getCollection } from 'astro:content'
import Heading from 'fulldev-ui/components/Heading.astro'
import Link from 'fulldev-ui/components/Link.astro'
import Column from 'fulldev-ui/components/structures/Column.astro'

const { sidebar } = Astro.props
const slug = Astro.url.pathname.replace(/^\/|\/$/g, '')
---

<Column
  as="aside"
  class="sidebar"
>
  {
    sidebar?.length > 0 &&
      sidebar.map((item: any) => (
        <>
          <Heading
            level={6}
            html={item.heading}
          />
          {item.links?.map((link: any) => (
            <Link
              {...link}
              class="sidebar-link"
              color={slug === link.href ? 'brand' : undefined}
            />
          ))}
          {item.folder &&
            (async () => {
              const pages = await getCollection(
                'pages',
                (entry: any) =>
                  entry.slug.startsWith(item.folder) &&
                  !entry.slug.endsWith(item.folder)
              )
              return pages.map((page: any) => (
                <Link
                  href={`/${page.slug}`}
                  class="sidebar-link"
                  color={slug === page.slug ? 'brand' : undefined}
                  text={page.data.title}
                />
              ))
            })()}
        </>
      ))
  }
</Column>

<style lang="scss">
  .sidebar {
    position: sticky;
    top: 0;
    box-sizing: border-box;
    border-right: 1px solid var(--border);
    padding: var(--space-5) var(--space-7) var(--space-5) var(--gutter);
    max-height: 100vh;
    overflow-y: auto;

    .sidebar-link {
      font-size: var(--text-1);
    }

    @media (max-width: 767px) {
      display: none;
    }
  }
</style>
