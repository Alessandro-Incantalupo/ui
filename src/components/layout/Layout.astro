---
import type { ComponentProps } from 'astro/types'
import { LayoutBody, LayoutHead, LayoutMain, LayoutRoot } from '.'
import { buildProps, type BuildProps, type GetReference } from '../../utils'
import { Banner } from '../banner'
import { Footer } from '../footer'
import { Header } from '../header'
import Legal from '../legal/Legal.astro'
import { Prose } from '../prose'
import { Section } from '../section'
import { Sections } from '../sections'

interface Base
  extends GetReference,
    Pick<ComponentProps<typeof Header>, 'header' | '_header'>,
    Pick<ComponentProps<typeof LayoutHead>, 'head' | '_head'>,
    Pick<ComponentProps<typeof Footer>, 'footer' | '_footer'>,
    Pick<ComponentProps<typeof Banner>, 'banner' | '_banner'>,
    Pick<ComponentProps<typeof Prose>, 'prose' | '_prose'>,
    Pick<ComponentProps<typeof Legal>, 'legal' | '_legal'> {
  hero?: ComponentProps<typeof Section>['section']
  _hero?: ComponentProps<typeof Section>['_section']
  cta?: ComponentProps<typeof Section>['section']
  _cta?: ComponentProps<typeof Section>['_section']
}

type Props = BuildProps<Base, 'layout'>
const props = buildProps(Astro, 'layout')

const {
  head,
  _head,
  banner,
  _banner,
  header,
  _header,
  hero,
  _hero,
  prose,
  _prose,
  cta,
  _cta,
  footer,
  _footer,
  legal,
  _legal,
  ...restProps
} = props

// const _layout = await getEntry('settings', 'layout')
---

<LayoutRoot {...props}>
  <LayoutHead
    {...props}
    {head}
    {_head}
  >
    <slot name="head" />
  </LayoutHead>
  <LayoutBody {...props}>
    <Banner
      {banner}
      {_banner}
    />
    <Header
      {header}
      {_header}
    />
    <LayoutMain {...props}>
      <Section
        id="hero"
        section={hero}
        _section={_hero}
        {prose}
        {_prose}
        {...restProps}
      />
      <!-- <Prose
        {prose}
        {_prose}
        {...restProps}
      /> -->
      <Sections {...props} />
      <Section
        id="cta"
        section={cta}
        _section={_cta}
      />
    </LayoutMain>
    <Footer
      {footer}
      {_footer}
    />
    <Legal
      {legal}
      {_legal}
    />
  </LayoutBody>
</LayoutRoot>
