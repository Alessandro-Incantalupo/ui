---
import { getCollection, type CollectionEntry } from 'astro:content'
import { CategoriesDeck } from '.'
import Layout from '../../elements/layout/Layout.astro'
import { ProductsDeck } from '../products'

interface Props {
  entry: CollectionEntry<'categories'>
}

const { entry } = Astro.props

const allProducts = await getCollection('products')
const filteredProducts = allProducts.filter((product) => {
  const found = product.data.categories.includes(entry.slug)
  return found
})
const mappedProducts = filteredProducts.map((product) => {
  return product.slug
})
---

<Layout
  {...entry.data}
  class="categories-layout"
>
  <ProductsDeck
    heading={entry.data.heading}
    text={entry.data.text}
    layout="grid"
    products={mappedProducts}
  />
  <CategoriesDeck
    layout="carousel"
    heading="Overige categorieÃ«n"
    categories={[
      'badkamer',
      'veiligheid',
      'trapliften',
      'woonkamer',
      'badkamer',
      'veiligheid',
      'trapliften',
      'woonkamer',
    ]}
  />
  <slot />
</Layout>
