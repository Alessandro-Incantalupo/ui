---
import { getCollection } from 'astro:content'
import { getRouteByEntry } from 'src/utils'
import type { Props as SectionProps } from '../../elements/section/Section.astro'
import Section from '../../elements/section/Section.astro'
import type { Props as ReviewsCardProps } from './ReviewsCard.astro'

interface Props
  extends Pick<SectionProps, 'tagline' | 'heading' | 'text' | 'buttons'> {
  reviews: ReviewsCardProps[] | null
}

const { props } = Astro

const allEntries = await getCollection('reviews')

const mappedReviews = props.reviews?.map((review) => {
  // @ts-ignore
  const found = allEntries.find((entry) => review.includes(entry.slug))

  if (!found) return found
  return { ...found?.data, href: getRouteByEntry(found) }
})
---

<Section
  class="reviews-section"
  cards={mappedReviews}
  {...props}
/>
