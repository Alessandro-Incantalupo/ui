---
import type { CollectionEntry } from 'astro:content'
import Block from 'fulldev-ui/components/Block.astro'
import Blocks from 'fulldev-ui/components/Blocks.astro'
import Button from 'fulldev-ui/components/Button.astro'
import Head from 'fulldev-ui/components/Head.astro'
import Sidebar from 'fulldev-ui/components/Sidebar.astro'

type Props = Partial<CollectionEntry<'pages'>> & {
  class?: string
}

const { slug, data, class: classes } = Astro.props
const { logo, header, headers, footer, footers, channels, sidebar } = data || {}
---

<!doctype html>
<html
  lang="nl"
  class:list={[
    slug,
    {
      'theme-dark': data?.theme === 'dark',
    },
  ]}
>
  <Head {...Astro.props} />
  <body
    class:list={[
      classes,
      {
        'has-sidebar': sidebar,
      },
    ]}
  >
    <Block
      _bookshop_name="Header"
      {logo}
      {...header}
    />
    <Blocks {...headers} />
    <Sidebar {sidebar} />
    <main
      data-pagefind-body
      class:list={[
        classes,
        {
          'has-sidebar': sidebar,
        },
      ]}
    >
      <slot />
    </main>
    {
      channels?.whatsapp && (
        <Button
          variant="solid"
          color="brand"
          icon="brand-whatsapp"
          size="lg"
          href={`https://wa.me/${channels.whatsapp}`}
          style={{
            position: 'fixed',
            right: 'var(--space-4)',
            bottom: 'var(--space-4)',
            backgroundColor: '#46A758',
          }}
        />
      )
    }
    <Block
      _bookshop_name="Footer"
      {logo}
      {...footer}
    />
    <Blocks {...footers} />
    <Fragment set:html={data?.code?.body} />
    <style lang="scss" is:global>
      :root {
        --screen: 1536px;
        --gutter: max(4vw, calc(100vw - var(--screen)) / 2);
      }

      html,
      body {
        box-sizing: border-box;
        margin: 0;
        background-color: var(--color-background);
        padding: 0;
        width: 100%;
        min-height: 100vh;
        color: var(--base-11);
        font-size: var(--text-2);
        font-family: var(--font-family);
      }
      body {
        --layout-padding-left: var(--gutter);
        --layout-padding-right: var(--gutter);
        --main-padding-left: var(--gutter);

        display: grid;
        // grid-template-rows: 150px auto auto;
        grid-template-areas:
          'header'
          'main'
          'footer';
        align-items: start;
        padding-right: var(--layout-padding-right);
        padding-left: var(--layout-padding-left);
        width: 100%;
        max-width: 100vw;

        &.has-sidebar {
          @media (min-width: 1024px) {
            grid-template-columns: auto 1fr;
            grid-template-areas:
              'header header'
              'sidebar main'
              'footer footer';
          }
        }

        .header {
          grid-area: header;
        }

        .sidebar {
          position: sticky;
          top: 0;
          grid-area: sidebar;
          // margin-left: calc(var(--gutter) * -1);
          // padding-left: var(--gutter);
        }

        main {
          --main-padding-left: 0px;
          display: flex;
          grid-area: main;
          flex-direction: column;
          padding-left: var(--main-padding-left);

          &.has-sidebar {
            @media (min-width: 1024px) {
              --main-padding-left: min(var(--gutter), var(--space-7));
            }
          }
        }

        .footer {
          grid-area: footer;
        }

        .header {
          margin-right: calc(var(--layout-padding-right) * -1) !important;
          margin-left: calc(var(--layout-padding-left) * -1) !important;
          padding-right: var(--layout-padding-right) !important;
          padding-left: var(--layout-padding-left) !important;
          width: calc(
            100% + var(--layout-padding-right) + var(--layout-padding-left)
          ) !important;
          max-width: none !important;
        }

        .section {
          margin-right: calc(var(--layout-padding-right) * -1) !important;
          margin-left: calc(var(--main-padding-left) * -1) !important;
          padding-right: var(--layout-padding-right) !important;
          padding-left: var(--main-padding-left) !important;
          width: calc(
            100% + var(--layout-padding-right) + var(--main-padding-left)
          ) !important;
          max-width: none !important;
        }
      }
    </style>
  </body>
</html>
