---
import type { CollectionEntry } from 'astro:content'
import Block from 'fulldev-ui/components/Block.astro'
import Blocks from 'fulldev-ui/components/Blocks.astro'
import Button from 'fulldev-ui/components/Button.astro'
import Sidebar from 'fulldev-ui/components/Sidebar.astro'
import Layout from 'fulldev-ui/layouts/Layout.astro'

type Props = CollectionEntry<'pages'>

const { logo, header, headers, footer, footers, channels, sidebar } =
  Astro.props.data || {}
---

<Layout {...Astro.props}>
  <Block
    _bookshop_name="Header"
    {logo}
    {...header}
  />
  <Blocks {...headers} />
  <div class="layout-container">
    <Sidebar {sidebar} />
    <main
      data-pagefind-body
      class:list={[
        {
          'has-sidebar': sidebar,
        },
      ]}
    >
      <slot />
    </main>
  </div>
  {
    channels?.whatsapp && (
      <Button
        variant="solid"
        color="brand"
        icon="brand-whatsapp"
        size="lg"
        href={`https://wa.me/${channels.whatsapp}`}
        style={{
          position: 'fixed',
          right: 'var(--space-4)',
          bottom: 'var(--space-4)',
          backgroundColor: '#46A758',
        }}
      />
    )
  }
  <Block
    _bookshop_name="Footer"
    {logo}
    {...footer}
  />
  <Blocks {...footers} />
</Layout>

<style lang="scss" is:global>
  .layout-container {
    width: 100%;

    .sidebar {
      display: none;
    }

    main {
      padding-right: var(--gutter);
      padding-left: var(--gutter);
      width: 100%;

      &.has-sidebar {
        padding-left: min(var(--gutter), var(--space-7));
      }

      .section {
        padding-right: 0 !important;
        padding-left: 0 !important;
      }
    }

    @media (min-width: 1024px) {
      display: flex;
      flex-direction: row;

      .sidebar {
        display: flex;
      }
    }
  }
</style>
