---
import { getCollection, type ContentCollectionKey } from 'astro:content'
import Layout from '../components/layout/Layout.astro'
import { getPathname } from '../utils'

export async function getStaticPaths() {
  const collections: ContentCollectionKey[] = [
    'pages',
    'services',
    'posts',
    'products',
    'categories',
    'forms',
    'policies',
    'persons',
  ]

  const promises = collections.map((collection) => getCollection(collection))
  const resolved = await Promise.all(promises)
  const flattened = resolved.flat()
  const filtered = flattened.filter(Boolean)
  // const entries = await withDefaults(filtered)
  const entries = filtered

  return entries.map((entry) => ({
    params: {
      pathname: getPathname(entry) === '/' ? undefined : getPathname(entry),
    },
    props: entry,
  }))
}

const { ...entry } = Astro.props

co
---

<Layout {...entry.data} />
