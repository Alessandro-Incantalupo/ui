---
import type { ComponentProps } from 'astro/types'
import { getCollection } from 'astro:content'
import { CategoryDeck } from '.'
import { Layout, Section } from '../../components'
import { ProductDeck } from '../product'

interface Props
  extends ComponentProps<typeof Layout>,
    ComponentProps<typeof CategoryDeck>,
    ComponentProps<typeof ProductDeck> {}

const { props } = Astro

const products = await getCollection('products', (product) =>
  product?.data?.categories?.includes(props.slug)
)

const categories = await getCollection(
  'categories',
  (category) => category.slug !== props.slug
)
---

<Layout
  {...props}
  class="category-layout"
>
  <ProductDeck
    {...props}
    layout="grid"
    products={products.map((product) => product?.data)}
  />
  <!-- TODO: seo tekst hieronder in 2 col layout -->
  <!-- <Section {...entry} /> -->
  <CategoryDeck
    heading={'Overige categorieÃ«n'}
    frame="panel"
    categories={categories.map(({ slug }) => slug)}
  />
  <slot />
</Layout>
