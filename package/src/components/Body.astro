---
import { merge } from 'merge-anything'
import { z } from 'zod'
import { buildProps, parseProps } from '../utils/props'
import Footer, { footerSchema } from './Footer.astro'
import Header, { headerSchema } from './Header.astro'
import Prose from './Prose.astro'
import Section, { sectionSchema } from './Section.astro'
import SectionGroup, { sectionGroupSchema } from './SectionGroup.astro'
import Tag from './Tag.astro'

type Props = z.infer<typeof bodySchema>

export const bodySchema = buildProps({
  ...sectionSchema.shape,
  output: z.boolean().nullish(),
  header: headerSchema,
  section: sectionSchema,
  sectionGroup: sectionGroupSchema,
  hero: sectionSchema,
  cta: sectionSchema,
  footer: footerSchema,
  render: z.any().nullish(),
})

const { as = 'body', render, ...rest } = parseProps(bodySchema, Astro.props)
---

<Tag
  class="body hue-base hue-accent font-body"
  {as}
  {...rest}
>
  <!-- <Banner></Banner> -->
  <Header {...rest.header} />
  <SectionGroup {...rest.sectionGroup}>
    <Section
      class="hero"
      slot="before"
      {...merge(rest ?? {}, rest.hero ?? {})}
      prose={{
        render: render,
      }}
    />
    <Section slot="before">
      <Prose {render} />
    </Section>
    <Section
      class="cta"
      slot="after"
      {...rest.cta}
    />
  </SectionGroup>
  <slot />
  <Footer {...rest.footer} />
  <!-- <Legal {...rest} /> -->

  <style is:global>
    .body {
      @apply font-body;

      transition: var(--transition);
      background: var(--hue1);
      height: 100%;
      min-height: 100vh;
      color: var(----hue11);

      &.dark {
        color-scheme: dark;
      }
      &.light {
        color-scheme: light;
      }
    }
  </style>
</Tag>
