---
import { z } from 'zod'
import { allowedComponents } from '../schemas/dynamicComponentsSchema'

export const dynamicSchema = z.object({}).catchall(z.any())

const props = dynamicSchema.parse(Astro.props)

function toPascalCase(str: string) {
  return str.charAt(0).toUpperCase() + str.slice(1)
}
---

{
  Object.entries(props).map(([key, value]) => {
    let Component = allowedComponents[toPascalCase(key)]

    if (value?.component)
      Component = allowedComponents[toPascalCase(value.component)]

    if (value?.tag) Component = allowedComponents['Element']

    if (!Component) return null

    return (
      <Component
        class:list={[value?.component || value?.tag ? key.toLowerCase() : '']}
        {...value}
      />
    )
  })
}
