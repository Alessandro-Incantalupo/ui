---
import type { HTMLTag, Polymorphic } from 'astro/types'
import { htmlElementAttributes } from 'html-element-attributes'

type Props<As extends HTMLTag> = Polymorphic<{ as: As }> & {
  compact?: boolean | null
  contrast?: boolean | null
  scheme?: 'light' | 'dark' | null
  color?: 'base' | 'accent' | null
  size?: 'small' | 'medium' | 'large' | null

  // sometimes
  look?: any
  order?: any
  align?: any
  layout?: any
  frame?: any
}

const {
  as: As = 'div',
  align,
  layout,
  hue,
  color,
  scheme,
  size,
  look,
  order,
  frame,
  compact,
  contrast,
  ...rest
} = Astro.props

const slot = await Astro.slots.render('default')
const hasContent = slot?.trim().length > 0

const attributes = Object.fromEntries(
  Object.entries(rest).filter(
    ([key]) =>
      (htmlElementAttributes['*'].includes(key) ||
        htmlElementAttributes[As]?.includes(key) ||
        key.startsWith('data-') ||
        key.startsWith('aria-')) &&
      key !== 'title'
  )
)
---

{
  hasContent && (
    <As
      class:list={[
        {
          compact,
          contrast,
        },
        color ? `hue-${color}` : '',
        scheme,
        size,
        // sometimes
        align,
        layout,
        hue,
        scheme,
        size,
        look,
        order,
        frame,
      ]}
      {...attributes}
    >
      <Fragment set:html={slot} />
    </As>
  )
}
