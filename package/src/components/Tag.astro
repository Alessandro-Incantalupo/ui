---
import type { HTMLAttributes, HTMLTag } from 'astro/types'
import { htmlElementAttributes } from 'html-element-attributes'

type Poly = {
  as?: HTMLTag
}

interface Props extends Poly {
  if?: string | boolean
  // polymorphic
  class?: HTMLAttributes<HTMLTag>['class']
  id?: HTMLAttributes<HTMLTag>['id']
  style?: HTMLAttributes<HTMLTag>['style']
  // design
  compact?: boolean | null
  scheme?: 'light' | 'dark' | null
  color?: 'base' | 'accent' | null
  size?: '1' | '2' | '3' | '4' | null
  // components
  variant?: 'solid' | 'soft' | 'surface' | 'outline' | 'ghost' | null
  contrast?: boolean | null
  // temp
  rows?: HTMLAttributes<'textarea'>['rows']
  alt?: HTMLAttributes<'img'>['alt']
  src?: HTMLAttributes<'img'>['src']
  method?: HTMLAttributes<'form'>['method']
  // type?: HTMLAttributes<'button'>['type']
  for?: HTMLAttributes<'label'>['for']
}

const {
  // @ts-ignore
  if: ifProp,
  as: As = 'div',
  variant,
  contrast,
  compact,
  scheme,
  color,
  size,
  ...rest
} = Astro.props

const htmlAttributes = Object.fromEntries(
  Object.entries(rest).filter(
    ([key]) =>
      (Object.values(htmlElementAttributes).flat().includes(key) ||
        key.startsWith('data-') ||
        key.startsWith('aria-')) &&
      key !== 'title'
  )
)

const slot = await Astro.slots.render('default')
const hasContent = slot?.trim().length > 0
// @ts-ignore
const hasProp = ifProp === true || Astro.props[ifProp]
---

{
  (hasProp || hasContent) && (
    <As
      class:list={[
        { compact, contrast },
        color ? `hue-${color}` : '',
        variant ? `variant-${variant}` : '',
        size ? `size-${size}` : '',
        scheme,
        size,
      ]}
      {...htmlAttributes}
    >
      <Fragment set:html={slot} />
    </As>
  )
}
