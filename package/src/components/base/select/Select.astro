---
import type { ComponentProps, Polymorphic } from 'astro/types'
import Component from '../../_Component.astro'
import Label from '../../typography/Label.astro'
import Icon from '../Icon.astro'
import SelectControl from './SelectControl.astro'
import SelectField from './SelectField.astro'
import SelectOption from './SelectOption.astro'
import SelectPlaceholder from './SelectPlaceholder.astro'

type Props<As extends 'div'> = Polymorphic<{ as: As }> & {
  label?: ComponentProps<typeof Label> | ComponentProps<typeof Label>['text']
  field?: ComponentProps<typeof SelectField>
  control?: ComponentProps<typeof SelectControl>
  placeholder?:
    | ComponentProps<typeof SelectPlaceholder>
    | ComponentProps<typeof SelectPlaceholder>['text']
  options?: (
    | ComponentProps<typeof SelectOption>
    | ComponentProps<typeof SelectOption>['text']
  )[]
  icon?: ComponentProps<typeof Icon> | ComponentProps<typeof Icon>['name']
} & Pick<ComponentProps<typeof SelectControl>, 'name'>

const {
  as = 'div',
  icon = 'chevron-down',
  label,
  name,
  placeholder,
  options,
  field,
  control,
  ...rest
} = Astro.props
---

<Component
  class:list={['select']}
  {as}
  {...rest}
>
  <Label
    for={name}
    {...typeof label === 'string' ? { text: label } : label}
  />
  <SelectField {...field}>
    <SelectControl
      id={name}
      {name}
      {...field}
    >
      <SelectPlaceholder
        {...typeof placeholder === 'string'
          ? { text: placeholder }
          : placeholder}
      />
      {
        options?.map((option: any) => (
          <SelectOption
            {...(typeof option === 'string' ? { text: option } : option)}
          />
        ))
      }
      <slot />
    </SelectControl>
    <Icon
      class:list={['select-icon']}
      {...typeof icon === 'string' ? { name: icon } : icon}
    />
  </SelectField>
</Component>

<style is:global lang="scss">
  @import '../../../css/utils.scss';

  @include component('select') {
    display: flex;
    position: relative;
    flex-direction: column;
    gap: var(--space-1);
    width: 100%;
  }

  @include component('select-icon') {
    position: absolute;
    top: 50%;
    right: var(--space-2);
    transform: translateY(-50%);
  }
</style>
