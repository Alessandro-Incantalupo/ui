---
import { isObject, pascal } from 'radash'
import { isArray, isString } from 'remeda'

interface Props {
  Content?: any
  [key: string]: any
}

const libraryComponents = await Astro.glob('../**/*.astro')
const userComponents = await Astro.glob('/src/components/**/*.astro')
const components = [...userComponents, ...libraryComponents]

const { Content } = Astro.props
---

{
  Object.entries(Astro.props).map(([key, value]) => {
    const lastPart = key.split(/(?=[A-Z])/).pop()
    if (!lastPart) return null
    const part = pascal(lastPart)

    if (part === 'Text' && isString(value)) return value
    if (part === 'Html') return <Fragment set:html={value} />
    // if (part === 'Content') return <Content />

    const Component: any = components.find((component) => {
      const fileName = component.default.moduleId?.split('/').pop()
      const componentName = fileName?.split('.')[0]
      return componentName === part
    })?.default

    if (!Component) return null
    if (isObject(value) || isArray(value)) return <Component {...value} />
    return <Component html={value} />
  })
}
