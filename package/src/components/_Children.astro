---
import { pascal } from 'radash'
import { isString } from 'remeda'

const components = await Astro.glob('../**/*.astro')
---

{
  Object.entries(Astro.props).map(([key, value]) => {
    const lastPart = key.split(/(?=[A-Z])/).pop()
    if (!lastPart) return null
    const part = pascal(lastPart)

    if (part === 'Text' && isString(value)) return value
    if (part === 'Html') return <Fragment set:html={value} />

    const Component: any = components.find((component) => {
      const fileName = component.default.moduleId?.split('/').pop()
      const componentName = fileName?.split('.')[0]
      return componentName === part
    })?.default

    if (!Component) return null
    return <Component {...value} />
  })
}
