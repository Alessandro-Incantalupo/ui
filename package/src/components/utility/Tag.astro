---
import { z } from 'zod'
import { attributesSchema } from '../../schemas/attributesSchema'
import { propsSchema } from '../../schemas/componentSchema'

type Props = z.infer<typeof tagSchema>

export const tagSchema = propsSchema({
  as: z.string(),
  if: z.string().or(z.literal(true)),
  color: z.string(),
  scheme: z.string(),
  contrast: z.boolean(),
  compact: z.boolean(),
  size: z
    .enum(['1', '2', '3', '4'])
    .or(z.union([z.literal(1), z.literal(2), z.literal(3), z.literal(4)])),
  class: z.string(),
  style: z.string(),
  id: z.string(),
})

const {
  as: As = 'div',
  if: ifProp,
  color,
  scheme,
  contrast,
  size,
  compact,
  ...rest
} = tagSchema.parse(Astro.props)

const slot = await Astro.slots.render('default')
const hasSlot = slot?.trim().length > 0
---

{
  (hasSlot || ifProp) && (
    <As
      class:list={[
        { compact, contrast },
        color ? `hue-${color}` : '',
        size ? `size-${size}` : '',
        scheme,
      ]}
      {...attributesSchema.parse(rest)}
    >
      <Fragment set:html={slot} />
    </As>
  )
}
